<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <script
      async
      src="//consent.trustarc.com/notice?domain=ea.com&c=teconsent&js=nj&noticeType=bb&text=true&gtm=1"
      crossorigin
    ></script>

    <script>
      var __dispatched__ = {}; //Map of previously dispatched preference levels
      /*
      First step is to register with the CM API to receive callbacks when a preference update
      occurs. You must wait for the CM API (PrivacyManagerAPI object) to exist on the page before
      registering.
      */
      console.log("EVENT LISTENER!");
      var __i__ =
        self.postMessage &&
        setInterval(function () {
          if (self.PrivacyManagerAPI && __i__) {
            var apiObject = {
              PrivacyManagerAPI: {
                action: "getConsentDecision",
                timestamp: new Date().getTime(),
                self: self.location.host,
              },
            };
            self.top.postMessage(JSON.stringify(apiObject), "*");
            __i__ = clearInterval(__i__);
          }
        }, 50);
      /*
      Callbacks will occur in the form of a PostMessage event. This code listens for the
      appropriately formatted PostMessage event, gets the new consent decision, and then pushes
      the events into the GTM framework. Once the event is submitted, that consent decision is
      marked in the 'dispatched' map so it does not occur more than once.
      */
      self.addEventListener("message", function (e, d) {
        try {
          if (
            e.data &&
            (d = JSON.parse(e.data)) &&
            (d = d.PrivacyManagerAPI) &&
            d.capabilities &&
            d.action == "getConsentDecision"
          ) {
            var newDecision = self.PrivacyManagerAPI.callApi(
              "getGDPRConsentDecision",
              self.location.host
            ).consentDecision;
            newDecision &&
              newDecision.forEach(function (label) {
                if (!__dispatched__[label]) {
                  self.dataLayer &&
                    self.dataLayer.push({ event: "GDPR Pref Allows" + label });
                  __dispatched__[label] = 1;
                }
              });
          }
        } catch (xx) {
          /** not a cm api message **/
        }
      });
    </script>

    <!-- Google Tag Manager -->
    <script defer>
      (function (w, d, s, l, i) {
        w[l] = w[l] || [];
        w[l].push({ "gtm.start": new Date().getTime(), event: "gtm.js" });
        console.log("ANALYTICS FIRING!");
        var f = d.getElementsByTagName(s)[0],
          j = d.createElement(s),
          dl = l != "dataLayer" ? "&l=" + l : "";
        j.async = true;
        j.src = "https://www.googletagmanager.com/gtm.js?id=" + i + dl;
        f.parentNode.insertBefore(j, f);
      })(window, document, "script", "dataLayer", "GTM-TFTCVRC");
    </script>
    <!-- End Google Tag Manager -->
  </head>
  <body style="height: 100vh; width: 100vw; margin: 0">
    <!-- Google Tag Manager (noscript) -->
    <noscript
      ><iframe
        src="https://www.googletagmanager.com/ns.html?id=GTM-TFTCVRC"
        height="0"
        width="0"
        style="display: none; visibility: hidden"
      ></iframe
    ></noscript>
    <!-- End Google Tag Manager (noscript) -->
    <h2>Test Site</h2>
    <div
      id="consent_blackbar"
      style="position: fixed; bottom: 0; z-index: 100; width: 100%"
      class="consent-blackbar"
    ></div>
  </body>
</html>
